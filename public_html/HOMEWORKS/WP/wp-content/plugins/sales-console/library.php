<?phpinclude 'bookmethods.php';include "extensions/requests.php";$table =new TableArr(border(0).cellpadding(0).cellspacing(0).width(100),    new Row(        new Form(action('').id('library').method('post').name('library_search'),            new Column(width(15).align('left').valign('top').style('text-align: left;'),                new TableArr(border(0).cellpadding(0).cellspacing(2).id('formtable').width(100),                    new Row (                        new Column(align('right').width(7), new Label(new TextRender('Title:'))),                        new Column(width(93), book_request::InputTitle())                    ),                    new Row (                        new Column(align('right').width(7), new Label(new TextRender('Barcode:'))),                        new Column(width(93), book_request::InputBarcode())                    ),                    new Row (                        new Column(align('right').width(7), new Label(new TextRender('ISBN:'))),                        new Column(width(93), book_request::InputISBN())                    ),                    new Row (                        new Column(align('right').width(7), new Label(new TextRender('Publisher:'))),                        new Column(width(93), book_request::InputPublisher())                    ),                    new Row (                        new Column(align('right').width(7), new Label(new TextRender('Price:'))),                        new Column(width(93), book_request::InputPrice())                    ),                    new Row (                        new Column(width(35),                                page_action::InputAction(action_types::$search),                                button('Search')                        )                    )                )            ),            new Column(width(18).align('left').valign('top').style('text-align: left;'),                new TableArr(border(0).cellpadding(0).cellspacing(5).id('formtable').width(100),                    new Row(                        new Column(align('right'), new Label('', new TextRender('Department:'))),                        new Column(style('padding-left: 5px;'), new TextRender(wp_dropdown_categories(array(                            'hide_empty' => 0,                            'name' => book_request::$department,                            'hierarchical' => true,                            'show_option_all' => 'Choose one',                            'echo' => 0                        ))))                    ),                    new Row(                        new Column(align('right'), new Label(new TextRender('Availability:'))),                        new Column(style('padding-left: 5px;'),                            new Input(type('radio').name(book_request::$availability).value('Active')),                            new TextRender('Active '),                            new Input(type('radio').name(book_request::$availability).value('Inactive')),                            new TextRender('Inactive '))                        ),                    new Row(                        new Column(align('right'), new Label(new TextRender('Condition:'))),                        new Column(style('padding-left: 5px;'),                            new Input(type('radio').name(book_request::$condition).value('New')),                            new TextRender('New '),                            new Input(type('radio').name(book_request::$condition).value('Used')),                            new TextRender('Used '))                    )                )            )        ),        new Column(width(30)),        new Form(width(30).style('text-align: right;').method('POST').action('').name('adding_book'),            new Column(width(15).align('left').valign('top').style('text-align: left;'),                new TableArr(id('formtable').border(0).cellspacing(2).cellpadding(0).classType('inlineTable'),                    new Row(                        new Column(align('right'), new Label(new TextRender('Title:'))),                        new Column(style('padding-left: 5px;'), book_addition::InputTitle())                    ),                    new Row(                        new Column(align('right'), new Label(new TextRender('Department:'))),                        new Column(style('padding-left: 5px;'), new TextRender(wp_dropdown_categories(array(                            'hide_empty' => 0,                            'name' => book_addition::$department,                            'hierarchical' => true,                            'show_option_all' => 'Choose one',                            'echo' => 0                        ))))                    ),                    new Row(                        new Column(align('right'), new Label(new TextRender('Availability:'))),                        new Column(style('padding-left: 5px;'),                            new Input(type('radio').name(book_addition::$availability).value('Active')),                            new TextRender('Active '),                            new Input(type('radio').name(book_addition::$availability).value('Inactive')),                            new TextRender('Inactive '))                    ),                    new Row(                        new Column(align('right'), new Label(new TextRender('Cost:'))),                        new Column(style('padding-left: 5px;'), book_addition::InputCost())                    ),                    new Row(                        new Column(align('right'), new Label(new TextRender('Price:'))),                        new Column(style('padding-left: 5px;'), book_addition::InputPrice())                    )                )            ),            new Column(style('float: right; padding-left: 2px;').valign('top'),                new TableArr(id('formtable').border(0).cellspacing(5).cellpadding(0).classType('inlineTable'),                    new Row(                        new Column(align('right'), new Label(new TextRender('MSRP:'))),                        new Column(style('padding-left: 5px;'), book_addition::InputMSRP())                    ),                    new Row(                        new Column(align('right'), new Label('', new TextRender('Vendor:'))),                        new Column(style('padding-left: 5px;'), book_addition::InputPublisher())                    ),                    new Row(                        new Column(align('right'), new Label(new TextRender('Condition:'))),                        new Column(style('padding-left: 5px;'),                            new Input(type('radio').name(book_addition::$condition).value('New')),                            new TextRender('New '),                            new Input(type('radio').name(book_addition::$condition).value('Used')),                            new TextRender('Used '))                    ),                    new Row(                        new Column(align('right'), new Label('', new TextRender('ISBN:'))),                        new Column(style('padding-left: 5px;'), book_addition::InputISBN())                    ),                    new Row (                        new Column(),                        new Column(width(35).align('right'),                            page_action::InputAction(action_types::$add_book),                            new Input(classType('button-primary').type('submit').name('button').value('Add Book'))                        )                    )                )            )        )    ));echo $table->Render();global $wpdb;switch ($_REQUEST[request_page_action()]) {    case query_search_action():        querySearch();        break;    case book_select_action():        select_book();        break;    case add_book_action():        add_book();        break;    case change_book_action():        if (isset($_POST[update_book_set()])) {            update_book($_REQUEST[request_selected_book()]);            select_book();        } else if (isset($_POST[delete_book_set()])) {            delete_book($_REQUEST[request_selected_book()]);            querySearch();        }        break;    case add_consigner_to_book_action():        add_book_consigner();        select_book();        break;};function select_book() {    ?>    <table id="formtable" width="100%" border="0" cellspacing="0" cellpadding="0" style="margin: 10px 0 50px;">        <tr>            <th width="22%" align="left">Title</th>            <th width="auto" align="left">ISBN</th>            <th width="auto" align="left">Publisher</th>            <th width="auto" align="left">Book Cost</th>            <th width="auto" align="left">Retail price</th>            <th width="auto" align="left">Sale price</th>            <th width="auto" align="left">Condition</th>            <th width="auto" style="padding-right: 15px; padding-left: 15px;" align="left">Quantity</th>            <th width="auto" align="left">Barcode</th>            <th width="auto" align="left">Has Image?</th>        </tr>        <tr>            <td colspan="10">                <hr/>            </td>        </tr>        <?php        $product_id = $_REQUEST[request_selected_book()];        ?>        <form method="post" name="<?php echo request_page_action() ?>" >            <?php                book_edit($product_id);            ?>            <tr>                <td colspan="8">                </td>                <input name="<?php echo request_page_action() ?>" type="hidden" value="<?php echo change_book_action() ?>"/>                <td style="text-align: center">                        <?php store_product_id() ?>                        <?php store_query_info() ?>                        <button style="margin: 0 auto;" type="submit" name="<?php echo update_book_set() ?>" class="button-primary" value="Update Book">Update Book</button>                </td>                <td style="text-align: center">                        <?php store_product_id() ?>                        <?php store_query_info() ?>                        <button style="margin: 0 auto;" type="submit" name="<?php echo delete_book_set() ?>" class="button-primary" value="Delete Book">Delete Book</button>                </td>            </tr>        </form>        <tr>            <td colspan="10">                <hr/>            </td>        </tr>        <?php        edit_consigners($product_id)        ?>        <tr>            <td colspan="9">                <hr/>            </td>            <td width="auto">                <form method="POST" action="" name="back_to_query" align="center">                    <input name="<?php echo request_page_action() ?>" type="hidden" value="<?php echo query_search_action() ?>"/>                    <?php store_query_info() ?>                    <input type="submit" name="button" class="button-primary" value="Back to Search Results"/>                </form>            </td>        </tr>    </table><?php}function book_edit($product_id) {    ?>    <tr>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_title(); ?>" name="<?php echo request_change_book_title(); ?>" value="<?php echo get_the_title($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_isbn(); ?>" name="<?php echo request_change_book_isbn(); ?>" value="<?php echo get_book_sku($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_publisher(); ?>" name="<?php echo request_change_book_publisher(); ?>" value="<?php echo get_book_publisher($product_id) ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_cost(); ?>" name="<?php echo request_change_book_cost(); ?>" value="<?php echo get_book_cost($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_msrp(); ?>" name="<?php echo request_change_book_msrp(); ?>" value="<?php echo get_book_msrp($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_price(); ?>" name="<?php echo request_change_book_price(); ?>" value="<?php echo get_book_saleprice($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_condition(); ?>" name="<?php echo request_change_book_condition(); ?>" value="<?php echo get_book_condition($product_id); ?>"/> </td>        <td align="center"><?php echo get_consigner_count($product_id); ?></td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_barcode(); ?>" name="<?php echo request_change_book_barcode(); ?>" value="<?php echo get_book_barcode($product_id); ?>"/> </td>        <td align="center"><?php if (has_post_thumbnail($product_id)) echo 'Y'; else echo 'N'; ?></td>    </tr>    <?php}function edit_consigners($product_id) {    $consigners = get_book_consigners($product_id);    if (!empty($consigners)) {        $i = 1;        foreach ($consigners as $consigner) {            ?>            <tr>                <?php                ?>                <td>Consigner #<?php echo $i ?>:</td>                <td><?php echo get_the_title($consigner); ?></td>                <?php                ?>            </tr>            <?php            $i++;        }    }    ?>    <tr width="auto">        <td>            <form method="POST" action="" name="add_book_consigner">                <input type="hidden" name="<?php echo request_page_action() ?>" value="<?php echo add_consigner_to_book_action() ?>"/>                <?php                    store_product_id();                    store_query_info();                ?>                <input type="submit" class="button-primary" value="Add Book"/>            </form>        </td>    </tr>    <?php}function add_book_consigner() {    $product_id = $_REQUEST[request_selected_book()];    set_consigner_owner();    $consigner = get_consigner_owner_id();    add_book_and_consigner($product_id, $consigner);}function store_query_info() {    ?>        <input name="<?php echo request_book_barcode(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_barcode()]; ?>" />        <input name="<?php echo request_book_price(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_price()]; ?>" />        <input name="<?php echo request_book_title(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_title()]; ?>" />        <input name="<?php echo request_book_isbn(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_isbn()]; ?>" />        <input name="<?php echo request_book_publisher(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_publisher()]; ?>" />        <input name="<?php echo request_book_category(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_category()]; ?>" />        <input name="<?php echo request_book_availability(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_availability()]; ?>" />        <input name="<?php echo request_book_condition(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_condition()]; ?>" />    <?php}function store_product_id() {    $product_id = $_REQUEST[request_selected_book()];    ?>        <input type="hidden" name="<?php echo request_selected_book() ?>" value="<?php echo $product_id ?>"/>    <?php}function book_display($product_id) {    ?>        <tr>            <td>                <form method="POST" name="select_book">                    <input type="hidden" name="<?php echo request_selected_book() ?>" value="<?php echo $product_id ?>"/>                    <?php                        store_query_info();                    ?>                    <input name="<?php echo request_page_action() ?>" type="hidden" value="<?php echo book_select_action() ?>" />                    <input style="                        background:none!important;                         border:none;                        padding:0!important;                        /*optional*/                        font-family:arial,sans-serif; /*input has OS specific font-family*/                        color:#069;                        cursor:pointer;"                        type="submit" name="button" class="button" value="<?php echo the_title(); ?>" />                </form>            </td>            <td><?php echo get_book_sku($product_id); ?></td>            <td><?php echo get_book_publisher($product_id); ?></td>            <td><?php echo get_book_cost($product_id); ?></td>            <td><?php echo get_book_msrp($product_id); ?></td>            <td><?php echo get_book_saleprice($product_id); ?></td>            <td><?php echo get_book_condition($product_id); ?></td>            <td align="center"><?php echo get_consigner_count($product_id); ?></td>            <td><?php echo get_book_barcode($product_id); ?></td>            <td align="center"><?php                if (has_post_thumbnail($product_id)) {                    echo '<a href="post.php?post='.$product_id.'&action=edit">Y</a>';                }                else                    echo '<a href="post.php?post='.$product_id.'&action=edit">N</a>';                ?></td>        </tr>    <?php}function querySearch(){    ?>    <table id="formtable" width="100%" border="0" cellspacing="0" cellpadding="0" style="margin: 10px 0 50px;">        <tr>            <th width="30%" align="left">Title</th>            <th width="auto" align="left">ISBN</th>            <th width="auto" align="left">Publisher</th>            <th width="auto" align="left">Cost</th>            <th width="auto" align="left">Retail price</th>            <th width="auto" align="left">Sale price</th>            <th width="auto" align="left">Condition</th>            <th width="auto" align="left">Quantity</th>            <th width="auto" align="left">Barcode</th>            <th width="auto" align="left">Has Image?</th>        </tr>        <tr>            <td colspan="10">                <hr/>            </td>        </tr>        <?php        $args = array(            'numberposts' => -1,            'posts_per_page' => -1,            'order' => 'ASC',            'orderby' => 'date',            'post_type' => 'bookstore'        );        $meta_query_array = array('relation' => 'AND');        if ($_REQUEST[request_book_title()]) {            $args['s'] = $_REQUEST[request_book_title()];        }        if ($_REQUEST[request_book_category()]) {            $args['cat'] = $_REQUEST[request_book_category()];        }        if ($_REQUEST[request_book_publisher()]) {            $meta_query_array[] = array(                'key' => '_cmb_resource_publisher',                'value' => $_REQUEST[request_book_publisher()]            );        }        if ($_REQUEST[request_book_price()]) {            $meta_query_array[] = array(                'key' => '_cmb_resource_price',                'value' => $_REQUEST[request_book_price()]            );        };        if ($_REQUEST[request_book_barcode()]) {            $meta_query_array[] = array(                'key' => '_cmb_resource_barcode',                'value' => $_REQUEST[request_book_barcode()]            );        };        if ($_REQUEST[request_book_isbn()]) {            $meta_query_array[] = array(                'key' => '_cmb_resource_u-sku',                'value' => $_REQUEST[request_book_isbn()]            );            $meta_query_array[] = array(                'key' => '_cmb_resource_sku',                'value' => $_REQUEST[request_book_isbn()]            );        }        if ($_REQUEST[request_book_condition()]) {            $meta_query_array[] = array(                'key' => '_cmb_resource_condition',                'value' => $_REQUEST[request_book_condition()]            );        };        if ($_REQUEST[request_book_availability()]) {            $meta_query_array[] = array(                'key' => '_cmb_resource_condition',                'value' => $_REQUEST[request_book_availability()]            );        };        $args['meta_query'] = $meta_query_array;        $the_query = new WP_Query($args);        while ($the_query->have_posts()):            $the_query->the_post();            global $post;            $product_id = $post->ID;            book_display($product_id);        endwhile;        ?>    </table>    <?php}?>