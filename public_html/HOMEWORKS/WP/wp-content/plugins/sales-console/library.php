<?phpinclude 'bookmethods.php';include "extensions/includes.php";function media_selector_print_scripts() {    $my_saved_attachment_post_id = get_option( 'media_selector_attachment_id', 0 );    $sel = selection::$book;    ?><script type='text/javascript'>        jQuery( document ).ready( function( $ ) {            // Uploading files            var file_frame;            //var wp_media_post_id = wp.media.model.settings.post.id; // Store the old id            //var set_to_post_id = 0;            jQuery('#upload_image_button').on('click', function( event ){                event.preventDefault();                // If the media frame already exists, reopen it.                if ( file_frame ) {                    // Set the post ID to what we want                    //file_frame.uploader.uploader.param( 'post_id', set_to_post_id );                    // Open frame                    file_frame.open();                    return;                } else {                    // Set the wp.media post id so the uploader grabs the ID we want when initialised                    //wp.media.model.settings.post.id = set_to_post_id;                }                // Create the media frame.                file_frame = wp.media.frames.file_frame = wp.media({                    title: 'Select a image to upload',                    button: {                        text: 'Use this image',                    },                    multiple: false	// Set to true to allow multiple files to be selected                });                // When an image is selected, run a callback.                file_frame.on( 'select', function() {                    // We set multiple to false so only get one image from the uploader                    attachment = file_frame.state().get('selection').first().toJSON();                    // Do something with attachment.id and/or attachment.url here                    $( '#image-preview' ).attr( 'src', attachment.url ).css( 'width', 'auto' );                    $( '#image_attachment_id' ).val( attachment.id );                    // Restore the main post ID                    //wp.media.model.settings.post.id = wp_media_post_id;                });                // Finally, open the modal                file_frame.open();            });            // Restore the main ID when the add media button is pressed            jQuery( 'a.add_media' ).on( 'click', function() {                //wp.media.model.settings.post.id = wp_media_post_id;            });        });    </script><?php}wp_enqueue_media();//media_selector_settings_page_callback();GenerateSearchAndAdd()->Render();$library_search = array(    book_properties::$title => true,    book_properties::$publisher => true,    book_properties::$barcode => true,    book_properties::$isbn => true,    book_properties::$cost => true,    book_properties::$MSRP => true,    book_properties::$price => true,    book_properties::$selectable => true,    book_properties::$condition => true,    book_properties::$availability => true,    book_properties::$quantity => true,    book_properties::$hasimage => true);global $wpdb;switch (page_action::GetAction()) {    case action_types::$search:        search_books($library_search)->Render();        break;    case action_types::$add_image_to_book:        add_image(selection::GetBook());        search_books($library_search)->Render();        break;    case action_types::$select_book:        select_book();        break;    case action_types::$add_book:        add_book();        break;    case action_types::$edit_book:        update_book(selection::GetBook());        select_book();        break;    case action_types::$delete_book:        delete_book(selection::GetBook());        search_books($library_search)->Render();        break;    case add_consigner_to_book_action():        add_book_consigner();        echo select_book();        break;};media_selector_print_scripts();function add_image($id) {    set_post_thumbnail($id, absint( $_POST['image_attachment_id']));}function select_book() {    return new TableArr(id('formtable').width(100).border(0).cellspacing(0).cellpadding(0).style('margin: 10px 0 50px;'),        new Row(            new Column(width(22).align('left'), new TextRender('Title')),            new Column(align('left'), new TextRender('ISBN')),            new Column(align('left'), new TextRender('Publisher')),            new Column(align('left'), new TextRender('Cost')),            new Column(align('left'), new TextRender('Retail Price')),            new Column(align('left'), new TextRender('Sale Price')),            new Column(align('left'), new TextRender('Barcode')),            new Column(align('left').style('padding-right: 15px; padding-left: 15px;'), new TextRender('Quantity')),            new Column(align('left'), new TextRender('Has Image?'))        )    );}function book_edit($product_id) {    ?>    <tr>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_title(); ?>" name="<?php echo request_change_book_title(); ?>" value="<?php echo get_the_title($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_isbn(); ?>" name="<?php echo request_change_book_isbn(); ?>" value="<?php echo get_book_sku($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_publisher(); ?>" name="<?php echo request_change_book_publisher(); ?>" value="<?php echo get_book_publisher($product_id) ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_cost(); ?>" name="<?php echo request_change_book_cost(); ?>" value="<?php echo get_book_cost($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_msrp(); ?>" name="<?php echo request_change_book_msrp(); ?>" value="<?php echo get_book_msrp($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_price(); ?>" name="<?php echo request_change_book_price(); ?>" value="<?php echo get_book_saleprice($product_id); ?>"/> </td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_condition(); ?>" name="<?php echo request_change_book_condition(); ?>" value="<?php echo get_book_condition($product_id); ?>"/> </td>        <td align="center"><?php echo get_consigner_count($product_id); ?></td>        <td valign="top"><input style="width: 100%; padding: 6px 4px 6px" type="text" id="<?php echo request_change_book_barcode(); ?>" name="<?php echo request_change_book_barcode(); ?>" value="<?php echo get_book_barcode($product_id); ?>"/> </td>        <td align="center"><?php if (has_post_thumbnail($product_id)) echo 'Y'; else echo 'N'; ?></td>    </tr>    <?php}function edit_consigners($product_id) {    $consigners = get_book_consigners($product_id);    if (!empty($consigners)) {        $i = 1;        foreach ($consigners as $consigner) {            ?>            <tr>                <?php                ?>                <td>Consigner #<?php echo $i ?>:</td>                <td><?php echo get_the_title($consigner); ?></td>                <?php                ?>            </tr>            <?php            $i++;        }    }    ?>    <tr width="auto">        <td>            <form method="POST" action="" name="add_book_consigner">                <input type="hidden" name="<?php echo request_page_action() ?>" value="<?php echo add_consigner_to_book_action() ?>"/>                <?php                    store_product_id();                    store_query_info();                ?>                <input type="submit" class="button-primary" value="Add Book"/>            </form>        </td>    </tr>    <?php}function add_book_consigner() {    $product_id = $_REQUEST[request_selected_book()];    set_consigner_owner();    $consigner = get_consigner_owner_id();    add_book_and_consigner($product_id, $consigner);}function store_query_info() {    ?>        <input name="<?php echo request_book_barcode(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_barcode()]; ?>" />        <input name="<?php echo request_book_price(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_price()]; ?>" />        <input name="<?php echo request_book_title(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_title()]; ?>" />        <input name="<?php echo request_book_isbn(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_isbn()]; ?>" />        <input name="<?php echo request_book_publisher(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_publisher()]; ?>" />        <input name="<?php echo request_book_category(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_category()]; ?>" />        <input name="<?php echo request_book_availability(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_availability()]; ?>" />        <input name="<?php echo request_book_condition(); ?>" type="hidden" value="<?php echo $_REQUEST[request_book_condition()]; ?>" />    <?php}function store_product_id() {    $product_id = $_REQUEST[request_selected_book()];    ?>        <input type="hidden" name="<?php echo request_selected_book() ?>" value="<?php echo $product_id ?>"/>    <?php}function GenerateSearchAndAdd() {    return new TableArr(border(0).cellpadding(0).cellspacing(0).width(100),        new Row(            new Form(action('').id('library').method('post').name('library_search'),                new Column(width(15).align('left').valign('top').style('text-align: left;'),                    new TableArr(border(0).cellpadding(0).cellspacing(2).id('formtable').width(100),                        new Row (                            new Column(align('right').width(7), new Label(new TextRender('Title:'))),                            new Column(width(93), book_request::InputTitle())                        ),                        new Row (                            new Column(align('right').width(7), new Label(new TextRender('Barcode:'))),                            new Column(width(93), book_request::InputBarcode())                        ),                        new Row (                            new Column(align('right').width(7), new Label(new TextRender('ISBN:'))),                            new Column(width(93), book_request::InputISBN())                        ),                        new Row (                            new Column(align('right').width(7), new Label(new TextRender('Publisher:'))),                            new Column(width(93), book_request::InputPublisher())                        ),                        new Row (                            new Column(align('right').width(7), new Label(new TextRender('Price:'))),                            new Column(width(93), book_request::InputPrice())                        ),                        new Row (                            new Column(width(35),                                page_action::InputAction(action_types::$search),                                button('Search')                            )                        )                    )                ),                new Column(width(18).align('left').valign('top').style('text-align: left;'),                    new TableArr(border(0).cellpadding(0).cellspacing(5).id('formtable').width(100),                        new Row(                            new Column(align('right'), new Label('', new TextRender('Department:'))),                            new Column(style('padding-left: 5px;'), new TextRender(wp_dropdown_categories(array(                                'hide_empty' => 0,                                'name' => book_request::$department,                                'hierarchical' => true,                                'show_option_all' => 'Choose one',                                'echo' => 0                            ))))                        ),                        new Row(                            new Column(align('right'), new Label(new TextRender('Availability:'))),                            new Column(style('padding-left: 5px;'),                                new Input(type('radio').name(book_request::$availability).value('Active')),                                new TextRender('Active '),                                new Input(type('radio').name(book_request::$availability).value('Inactive')),                                new TextRender('Inactive '))                        ),                        new Row(                            new Column(align('right'), new Label(new TextRender('Condition:'))),                            new Column(style('padding-left: 5px;'),                                new Input(type('radio').name(book_request::$condition).value('New')),                                new TextRender('New '),                                new Input(type('radio').name(book_request::$condition).value('Used')),                                new TextRender('Used '))                        )                    )                )            ),            new Column(width(30)),            new Form(width(30).style('text-align: right;').method('POST').action('').name('adding_book'),                new Column(width(15).align('left').valign('top').style('text-align: left;'),                    new TableArr(id('formtable').border(0).cellspacing(3).cellpadding(0).classType('inlineTable'),                        new Row(                            new Column(align('right'), new Label(new TextRender('Title:'))),                            new Column(style('padding-left: 5px;'), book_addition::InputTitle())                        ),                        new Row(                            new Column(align('right'), new Label(new TextRender('Department:'))),                            new Column(style('padding-left: 5px;'), new TextRender(wp_dropdown_categories(array(                                'hide_empty' => 0,                                'name' => book_addition::$department,                                'hierarchical' => true,                                'show_option_all' => 'Choose one',                                'echo' => 0                            ))))                        ),                        new Row(                            new Column(align('right'), new Label(new TextRender('Availability:'))),                            new Column(style('padding-left: 5px;'),                                new Input(type('radio').name(book_addition::$availability).value('Active')),                                new TextRender('Active '),                                new Input(type('radio').name(book_addition::$availability).value('Inactive')),                                new TextRender('Inactive '))                        ),                        new Row(                            new Column(align('right'), new Label(new TextRender('Cost:'))),                            new Column(style('padding-left: 5px;'), book_addition::InputCost())                        ),                        new Row(                            new Column(align('right'), new Label(new TextRender('Price:'))),                            new Column(style('padding-left: 5px;'), book_addition::InputPrice())                        )                    )                ),                new Column(style('float: right; padding-left: 2px;').valign('top'),                    new TableArr(id('formtable').border(0).cellspacing(5).cellpadding(0).classType('inlineTable'),                        new Row(                            new Column(align('right'), new Label(new TextRender('MSRP:'))),                            new Column(style('padding-left: 5px;'), book_addition::InputMSRP())                        ),                        new Row(                            new Column(align('right'), new Label('', new TextRender('Vendor:'))),                            new Column(style('padding-left: 5px;'), book_addition::InputPublisher())                        ),                        new Row(                            new Column(align('right'), new Label(new TextRender('Condition:'))),                            new Column(style('padding-left: 5px;'),                                new Input(type('radio').name(book_addition::$condition).value('New')),                                new TextRender('New '),                                new Input(type('radio').name(book_addition::$condition).value('Used')),                                new TextRender('Used '))                        ),                        new Row(                            new Column(align('right'), new Label('', new TextRender('ISBN:'))),                            new Column(style('padding-left: 5px;'), book_addition::InputISBN())                        ),                        new Row (                            new Column(),                            new Column(width(35).align('right'),                                page_action::InputAction(action_types::$add_book),                                new Input(classType('button-primary').type('submit').name('button').value('Add Book'))                            )                        )                    )                )            )        )    );}?>